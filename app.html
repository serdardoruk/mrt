<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Omerta War Planner</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            background: linear-gradient(135deg, #f6f8fc, #eef2f7); 
            min-height: 100vh; 
            color: #0f172a; 
            font-size: 14px;
        }
        
        /* Header / Nav */
        .top-nav { 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            height: 50px; 
            background: #0f172a; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 12px; 
            z-index: 9999; 
            padding: 0 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        .top-nav a { 
            height: 36px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 6px; 
            padding: 0 14px; 
            border-radius: 8px; 
            background: #1e293b; 
            color: #94a3b8; 
            text-decoration: none; 
            font-size: 14px; 
            transition: all 0.2s; 
        }
        .top-nav a:hover { background: #334155; color: #fff; }
        .top-nav a.active { background: #2563eb; color: #fff; }
        .top-nav a span:first-child { font-size: 16px; }
        .nav-label { font-size: 13px; font-weight: 600; }
        .omerta-timer { 
            position: absolute; 
            left: 12px; 
            color: #fbbf24; 
            font-family: monospace; 
            font-size: 14px; 
            font-weight: 700; 
        }
        .logout-btn { 
            position: absolute !important; 
            right: 12px; 
            height: 32px !important; 
            padding: 0 10px !important; 
            background: transparent !important; 
            border: 1px solid #475569 !important; 
            color: #94a3b8 !important; 
        }
        .logout-btn:hover { 
            background: #dc2626 !important; 
            border-color: #dc2626 !important; 
            color: #fff !important; 
        }
        
        /* Content area */
        .app-content {
            margin-top: 50px;
            min-height: calc(100vh - 50px);
        }
        
        .app-content iframe {
            width: 100%;
            height: calc(100vh - 50px);
            border: none;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: calc(100vh - 50px);
            color: #64748b;
            font-size: 16px;
        }
        
        /* Mobile */
        @media (max-width: 768px) {
            .top-nav { 
                top: auto; 
                bottom: 0; 
                height: 60px; 
            }
            .app-content {
                margin-top: 0;
                margin-bottom: 60px;
            }
            .app-content iframe {
                height: calc(100vh - 60px);
            }
            .omerta-timer { display: none; }
            .logout-btn { position: relative !important; right: auto !important; }
        }
    </style>
</head>
<body>
    <!-- Login kontrol√º -->
    <script>
        try {
            if (!sessionStorage.getItem('omerta_user')) {
                window.location.href = 'index.html';
            }
        } catch(e) {
            window.location.href = 'index.html';
        }
    </script>

    <!-- Sabit Header -->
    <nav class="top-nav">
        <span class="omerta-timer" id="omertaTimer"></span>
        <a href="#matchings" data-page="matchings"><span>‚öîÔ∏è</span><span class="nav-label">Sava≈ü</span></a>
        <a href="#baskin" data-page="baskin"><span>üéØ</span><span class="nav-label">Baskƒ±n</span></a>
        <a href="#roster" data-page="roster"><span>üë•</span><span class="nav-label">Aileler</span></a>
        <a href="#admin" data-page="admin" id="adminLink" style="display:none;"><span>‚öôÔ∏è</span><span class="nav-label">Admin</span></a>
        <a href="#" class="logout-btn" id="logoutBtn"><span>üö™</span><span class="nav-label">√áƒ±kƒ±≈ü</span></a>
    </nav>

    <!-- Dinamik ƒ∞√ßerik Alanƒ± -->
    <main class="app-content" id="appContent">
        <div class="loading">Y√ºkleniyor...</div>
    </main>

    <script>
        // Sayfa e≈ülemeleri
        const PAGES = {
            'matchings': 'matchings_latest.html',
            'baskin': 'baskin.html',
            'roster': 'family_roster_latest.html',
            'admin': 'admin.html'
        };
        
        // Mevcut sayfa
        let currentPage = null;
        
        // Sayfa y√ºkle
        function loadPage(page) {
            if (currentPage === page) return;
            currentPage = page;
            
            const url = PAGES[page];
            if (!url) {
                page = 'matchings';
            }
            
            // Nav link'leri g√ºncelle
            document.querySelectorAll('.top-nav a[data-page]').forEach(link => {
                if (link.dataset.page === page) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
            
            // iframe ile y√ºkle (en basit ve g√ºvenilir yol)
            const content = document.getElementById('appContent');
            content.innerHTML = `<iframe src="${PAGES[page] || PAGES['matchings']}" id="pageFrame"></iframe>`;
        }
        
        // Hash deƒüi≈üikliƒüini dinle
        function handleHash() {
            let hash = window.location.hash.slice(1) || 'matchings';
            loadPage(hash);
        }
        
        // Omerta timer
        function updateTimer() {
            const el = document.getElementById('omertaTimer');
            if (!el) return;
            const now = new Date();
            const utc = Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), 
                                  now.getUTCHours(), now.getUTCMinutes(), now.getUTCSeconds());
            const hours = [0, 4, 8, 12, 16, 20];
            const todayMidnight = Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate());
            let nextOmerta = null;
            for (let h of hours) {
                const t = todayMidnight + h * 3600000;
                if (t > utc) { nextOmerta = t; break; }
            }
            if (!nextOmerta) nextOmerta = todayMidnight + 24 * 3600000;
            const diff = nextOmerta - utc;
            const m = Math.floor(diff / 60000);
            const s = Math.floor((diff % 60000) / 1000);
            el.textContent = '‚è± ' + String(m).padStart(2, '0') + ':' + String(s).padStart(2, '0');
        }
        
        // Admin link g√∂ster
        function setupAdmin() {
            try {
                const u = JSON.parse(sessionStorage.getItem('omerta_user') || '{}');
                if (u.username === 'admin') {
                    document.getElementById('adminLink').style.display = 'flex';
                }
            } catch(e) {}
        }
        
        // Logout
        document.getElementById('logoutBtn').addEventListener('click', (e) => {
            e.preventDefault();
            sessionStorage.removeItem('omerta_user');
            window.location.href = 'index.html';
        });
        
        // Ba≈ülat
        window.addEventListener('hashchange', handleHash);
        setupAdmin();
        updateTimer();
        setInterval(updateTimer, 1000);
        handleHash();
    </script>
</body>
</html>
