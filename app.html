<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Omerta War Planner</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            background: linear-gradient(135deg, #f6f8fc, #eef2f7); 
            min-height: 100vh; 
            color: #0f172a; 
            font-size: 14px;
        }
        
        /* Header / Nav */
        .top-nav { 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            height: 50px; 
            background: linear-gradient(135deg, #f8fafc, #e2e8f0); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 12px; 
            z-index: 9999; 
            padding: 0 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-bottom: 1px solid #cbd5e1;
        }
        .top-nav a { 
            height: 36px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 6px; 
            padding: 0 14px; 
            border-radius: 8px; 
            background: rgba(0,0,0,0.05); 
            color: #475569; 
            text-decoration: none; 
            font-size: 14px; 
            transition: all 0.2s; 
        }
        .top-nav a:hover { background: rgba(0,0,0,0.1); color: #1e293b; }
        .top-nav a.active { background: #2563eb; color: #fff; }
        .top-nav a span:first-child { font-size: 16px; }
        .nav-label { font-size: 13px; font-weight: 600; }
        
        /* Footer */
        .app-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 36px;
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            z-index: 9998;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
            border-top: 1px solid #cbd5e1;
            padding: 0 16px;
        }
        .footer-item {
            color: #475569;
            font-size: 11px;
            font-family: monospace;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .footer-item.update-time {
            color: #64748b;
        }
        .footer-item.current-time {
            color: #b45309;
            font-weight: 600;
        }
        .logout-btn { 
            height: 24px;
            padding: 0 12px;
            background: rgba(239,68,68,0.1);
            border: 1px solid #fca5a5;
            border-radius: 4px;
            color: #dc2626;
            text-decoration: none;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
        }
        .logout-btn:hover { 
            background: #dc2626;
            border-color: #dc2626;
            color: #fff;
        }
        
        /* Content area */
        .app-content {
            margin-top: 50px;
            margin-bottom: 40px;
            min-height: calc(100vh - 90px);
        }
        
        .app-content iframe {
            width: 100%;
            height: calc(100vh - 90px);
            border: none;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: calc(100vh - 50px);
            color: #64748b;
            font-size: 16px;
        }
        
        /* Mobile */
        @media (max-width: 768px) {
            .top-nav { 
                height: 50px; 
            }
            .app-footer {
                height: auto;
                min-height: 40px;
                padding: 8px 10px;
                flex-wrap: wrap;
                gap: 5px;
            }
            .footer-item {
                font-size: 11px;
                padding: 2px 6px;
            }
            .app-content {
                margin-top: 50px;
                margin-bottom: 60px;
            }
            .app-content iframe {
                height: calc(100vh - 110px);
            }
        }
    </style>
</head>
<body>
    <!-- Login kontrol√º -->
    <script>
        try {
            if (!sessionStorage.getItem('omerta_user')) {
                window.location.href = 'index.html';
            }
        } catch(e) {
            window.location.href = 'index.html';
        }
    </script>

    <!-- Fixed Header -->
    <nav class="top-nav">
        <a href="#matchings" data-page="matchings"><span>‚öîÔ∏è</span><span class="nav-label">War</span></a>
        <a href="#baskin" data-page="baskin" id="raidLink" style="display:none;"><span>üéØ</span><span class="nav-label">Raid</span></a>
        <a href="#roster" data-page="roster"><span>üë•</span><span class="nav-label">Families</span></a>
        <a href="#admin" data-page="admin" id="adminLink" style="display:none;"><span>‚öôÔ∏è</span><span class="nav-label">Admin</span></a>
    </nav>

    <!-- Dynamic Content Area -->
    <main class="app-content" id="appContent">
        <div class="loading">Loading...</div>
    </main>

    <!-- Fixed Footer -->
    <footer class="app-footer">
        <span class="footer-item current-time" id="currentTime">--:--:-- OT</span>
        <span class="footer-item update-time" id="updateTime">refreshed --</span>
        <a href="#" class="logout-btn" id="logoutBtn">Logout</a>
    </footer>

    <script>
        // Sayfa e≈ülemeleri
        const PAGES = {
            'matchings': 'matchings_latest.html',
            'baskin': 'baskin.html',
            'roster': 'family_roster_latest.html',
            'admin': 'admin.html'
        };
        
        // Mevcut sayfa
        let currentPage = null;
        
        // Sayfa y√ºkle
        function loadPage(page) {
            if (currentPage === page) return;
            currentPage = page;
            
            const url = PAGES[page];
            if (!url) {
                page = 'matchings';
            }
            
            // Nav link'leri g√ºncelle
            document.querySelectorAll('.top-nav a[data-page]').forEach(link => {
                if (link.dataset.page === page) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
            
            // iframe ile y√ºkle (en basit ve g√ºvenilir yol)
            const content = document.getElementById('appContent');
            content.innerHTML = `<iframe src="${PAGES[page] || PAGES['matchings']}" id="pageFrame"></iframe>`;
        }
        
        // Hash deƒüi≈üikliƒüini dinle
        function handleHash() {
            let hash = window.location.hash.slice(1) || 'matchings';
            loadPage(hash);
        }
        
        // Admin link g√∂ster
        function setupAdmin() {
            try {
                const u = JSON.parse(sessionStorage.getItem('omerta_user') || '{}');
                if (u.username === 'admin') {
                    document.getElementById('adminLink').style.display = 'flex';
                    document.getElementById('raidLink').style.display = 'flex';
                }
            } catch(e) {}
        }
        
        // G√ºncel saat (UTC/Omerta Time)
        function updateCurrentTime() {
            const el = document.getElementById('currentTime');
            if (!el) return;
            const now = new Date();
            const h = String(now.getUTCHours()).padStart(2, '0');
            const m = String(now.getUTCMinutes()).padStart(2, '0');
            const s = String(now.getUTCSeconds()).padStart(2, '0');
            el.textContent = h + ':' + m + ':' + s + ' OT';
        }
        
        // G√ºncelleme zamanƒ±nƒ± y√ºkle ve "refreshed X ago" olarak g√∂ster
        let refreshedTimestamp = null;
        async function loadUpdateTime() {
            try {
                const res = await fetch('data/update_time.txt');
                if (res.ok) {
                    const time = (await res.text()).trim();
                    // Parse: "DD.MM.YYYY HH:MM OT" -> Date
                    const match = time.match(/(\d{2})\.(\d{2})\.(\d{4})\s+(\d{2}):(\d{2})/);
                    if (match) {
                        const [, d, mo, y, h, mi] = match;
                        refreshedTimestamp = Date.UTC(+y, +mo - 1, +d, +h, +mi);
                    }
                    updateRefreshedAgo();
                }
            } catch(e) {}
        }
        function updateRefreshedAgo() {
            const el = document.getElementById('updateTime');
            if (!el || !refreshedTimestamp) return;
            const now = Date.now();
            const diff = now - refreshedTimestamp;
            const mins = Math.floor(diff / 60000);
            const hours = Math.floor(mins / 60);
            const days = Math.floor(hours / 24);
            let ago;
            if (days > 0) ago = days + 'd ago';
            else if (hours > 0) ago = hours + 'h ago';
            else if (mins > 0) ago = mins + 'm ago';
            else ago = 'just now';
            el.textContent = 'refreshed ' + ago;
        }
        
        // Logout
        document.getElementById('logoutBtn').addEventListener('click', (e) => {
            e.preventDefault();
            sessionStorage.removeItem('omerta_user');
            window.location.href = 'index.html';
        });
        
        // Ba≈ülat
        window.addEventListener('hashchange', handleHash);
        setupAdmin();
        updateCurrentTime();
        loadUpdateTime();
        setInterval(updateCurrentTime, 1000);
        setInterval(updateRefreshedAgo, 60000);
        handleHash();
    </script>
</body>
</html>
